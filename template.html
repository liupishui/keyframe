<!DOCTYPE html>
<html lang="zh-CN" style="overflow: hidden;">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <link href="https://cdn.staticfile.org/Swiper/4.5.1/css/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.staticfile.org/animate.css/3.7.2/animate.min.css" rel="stylesheet" type="text/css" />
    <title>demo</title>
    <style>
        @-webkit-keyframes nextPage {
            0% {
                -webkit-transform: translateY(40px) rotate(-45deg);
                opacity: 0.8;
            }
            50% {
                -webkit-transform: translateY(20px) rotate(-45deg);
                opacity: 0.4;
            }
            100% {
                -webkit-transform: translateY(10px) rotate(-45deg);
                opacity: 0;
            }
        }
        @-webkit-keyframes rolling {
            0% {
                -webkit-transform: rotateZ(0);
                opacity: 0.1;
            }
            25% {
                opacity: .2;
            }
            50% {
                -webkit-transform: rotateZ(180deg);
                opacity: .6;
            }
            75% {
                opacity: .75;
            }
            100% {
                -webkit-transform: rotateZ(360deg);
                opacity: .9;
            }
        }
        .nextPage {
            -webkit-animation: nextPage 1.2s linear infinite;
        }
        .rolling {
            -webkit-animation-timing-function: linear;
            animation-timing-function: linear;
            -webkit-animation-name: rolling;
            animation-name: rolling;
            -webkit-transform-origin: center bottom;
            transform-origin: center bottom;
        }

    </style>
    <style>
        html, body {
        position: relative;
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
        }
        .swiper-container {
            width: 100%;
            height: 100%;
        }
        .swiper-slide {
            -webkit-backface-visibility:hidden;
            -moz-backface-visibility:hidden;
            -ms-backface-visibility:hidden;
            backface-visibility:hidden;
            -webkit-perspective:1000;
            -moz-perspective:1000;
            -ms-perspective:1000;
            perspective:1000;
            text-align: center;
            font-size: 18px;
            background: #fff;

            /* Center slide text vertically */
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        .fallingDown{
            position: absolute;
            color:#fff;
            bottom: 2rem;
            left: 0;
            right: 0;

        }

        .btnNext{
            position: absolute;
            width: 0.4rem;
            height: 0.4rem;
            left: 0;
            right: 0;
            bottom: 5%;
            margin: 0 auto;
            border-top: 2px solid #fff;
            border-right: 2px solid #fff;
            z-index: 10000;
            opacity: 0.8;
        }


    </style>
</head>
    <body>
        <div id="iSlider-wrapper" class="swiper-container">
            <div class="swiper-wrapper">
                <div class="swiper-slide">Slide 1</div>
                <div class="swiper-slide">Slide 2</div>
                <div class="swiper-slide">Slide 3</div>
            </div>
        </div>
        <div class="btnNext nextPage"></div>

        <!--<aside class="media-wrap">
            <span id="musicBtnTxt" style="display: none;">关闭</span>
            <i id="musicBtn" class="music-btn on"></i>
        </aside>

        <audio src="//be-fe.github.io/static/audios/YouGotMe.mp3" autoplay="autoplay" loop="loop" id="autoplay"></audio>-->
        <!--
        <div class="sliders">
            <div class="item_first">
                <div class="dz1 animated" id="dz1">
                    <div class="dz11"></div>
                </div>
                <div class="dz2 animated" id="dz2">
                </div>
                <div class="dz3" id="dz3">
                </div>
                <div class="dz4" id="dz4">
                    <div class="dz41">
                    </div>
                    <div class="dz42">
                    </div>
                </div>
                <div class="dz5" id="dz5">
                    <div class="dz51">
                    </div>
                </div>
                <div class="dz6" id="dz6">
                </div>
            </div>
            <div>
                <img src="../images/1028_3.jpg" />
            </div>
        </div>-->
    </body>
    <script type="text/javascript" src="https://cdn.staticfile.org/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.staticfile.org/Swiper/4.5.1/js/swiper.min.js"></script>
    <script src="../js/iSlider.js" type="text/javascript"></script>
    <script type="text/javascript">
        var keyframeArr=[
            {//page
                element:'',
                background:'#a00',
                backgroundSize:'',
                layers:[//图层
                    {
                        dom:$("<div style=\"font-size:100px\">222222</div>"),
                        keyframe:[
                            {
                                className:'rolling|infinite',
                                delay:0,
                                duration:1000
                            },
                            {
                                className:'bounceInDown|infinite',
                                delay:6000,
                                duration:1000
                            }
                        ]
                    },
                    {
                        dom:$("<div class='fallingDown'>掉落</div>"),
                        keyframe:[
                            {
                                className:'bounceInDown',
                                delay:100,
                                duration:0
                            }
                        ]
                    }
                ]
            },
            {//page
                element:'',
                background:'#0a0',
                backgroundSize:'',
                layers:[//图层
                    {
                        dom:$("<div></div>"),
                        keyframe:[
                            {
                                className:'item_first_dz2',
                                delay:0,
                                duration:3000
                            }
                        ]
                    },
                    {
                        dom:$("<div class='fallingDown'>效果</div>"),
                        keyframe:[
                            {
                                className:'bounceInDown',
                                delay:100,
                                duration:0
                            },
                            // {
                            //     className:'rollOut',
                            //     delay:3000,
                            //     duration:0
                            // }
                        ]
                    }
                ]
            }
        ];
        var setupKeyFrame = function(layer,$element){
            layer.dom.addClass('animated');
            layer.beforeChange=function(){};
            layer.endChange=function(){};
            var currentIndex = 0,delayCount = 0;
            var setup = function(){
                if(currentIndex < layer.keyframe.length){
                    delayCount += layer.keyframe[currentIndex].delay;
                    if(currentIndex != 0){
                        delayCount += layer.keyframe[currentIndex-1].duration;
                    }
                    delayCount == 0 && (delayCount=1);
                    setTimeout(function(){
                        if($($element).has($(layer.dom)).length===0){
                            $(layer.dom).appendTo($element);
                        }
                        if(layer.keyframe[currentIndex].duration != 0){
                            $(layer.dom).css({'-webkit-animation-duration':layer.keyframe[currentIndex].duration+'ms'});
                            $(layer.dom).css({'animation-duration':layer.keyframe[currentIndex].duration+'ms'});
                        }

                        $.each(layer.keyframe,function(index,val){//清除其它动画
                            var classNameArr = val.className.split('|');
                            $.each(classNameArr,function(key,item){
                                    layer.dom.removeClass(item)
                            });
                        })

                        layer.beforeChange.call(layer,layer.keyframe[currentIndex],currentIndex);

                        (function(layer,currentIndex,delayCount){
                            setTimeout(function(){
                                layer.endChange.call(layer,layer.keyframe[currentIndex],currentIndex);
                            }, delayCount + layer.keyframe[currentIndex].duration);
                        })(layer,currentIndex,delayCount)

                        var classNameArrCurr = layer.keyframe[currentIndex].className.split('|');
                            $.each(classNameArrCurr,function(key,item){
                                    layer.dom.addClass(item)
                            });
                        currentIndex++;
                        setup();
                    },delayCount);
                }
            }
            setup();
            return layer;
        }
        var setupPageFrame = function(keyframeArr,index){
            if(typeof(keyframeArr[index])!='undefined'){
                var pageInfo = keyframeArr[index];
                if(pageInfo.element!=''){
                    $.each(pageInfo.layers,function(index,item){
                        item.dom.remove();
                    });
                    if(pageInfo.background!=''){
                        $(pageInfo.element).css('background',pageInfo.background);
                    }
                    if(pageInfo.backgroundSize!=''){
                        $(pageInfo.element).css('background-size',pageInfo.backgroundSize);
                    }
                    $.each(pageInfo.layers,function(index,layer){
                        var keyframeReturn = setupKeyFrame(layer,pageInfo.element);
                    })

                }
            }
        }
        var deletePageFrame = function(keyframeArr,index){
            if(typeof(keyframeArr[index])!='undefined'){
                var pageInfo = keyframeArr[index];
                if(pageInfo.element!=''){
                    $.each(pageInfo.layers,function(index,item){
                        item.dom.remove();
                    });
                }
            }
        }
        document.querySelector('body').style.visibility = 'visible';
        $(".swiper-slide").each(function(index,val){
            if(typeof(keyframeArr[index])!='undefined'){
                keyframeArr[index].element = $(this);
                console.log($(this));
            }
        });
        var swiper = new Swiper('.swiper-container', {
                direction: 'vertical',
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
            });
            swiper.on('touchStart',function(){
                var that = this;
                $.each(keyframeArr,function(index,val){
                    if(index!=that.activeIndex){
                        deletePageFrame(keyframeArr,index);
                    }
                })
                deletePageFrame(keyframeArr,)
            })
            swiper.on('slideChange',function(){
                console.log();
                // if(!$(this.slides[this.activeIndex]).attr('isRunKeyFrame')){
                    setupPageFrame(keyframeArr,this.activeIndex);
                    $(this.slides[this.activeIndex]).attr('isRunKeyFrame',true);
                // }
            });
            $(swiper.slides[swiper.activeIndex]).attr('isRunKeyFrame',true);
            setupPageFrame(keyframeArr,0);
            //音乐播放开始
            //        var audio = document.getElementById('autoplay');
            //        var controller = document.getElementById('musicBtn');
            //        var controllerHint = document.getElementById('musicBtnTxt');

            //        document.getElementById('musicBtn').addEventListener('touchstart', function () {

            //            controllerHint.style.display = '';
            //            if (audio.paused) {
            //                audio.play();
            //                controller.className = 'music-btn on';
            //                controllerHint.innerHTML = '开始';
            //            } else {
            //                audio.pause();
            //                controller.className = 'music-btn';
            //                controllerHint.innerHTML = '关闭';
            //            }

            //            setTimeout(function () {
            //                controllerHint.style.display = 'none';
            //            }, 1000);

                    //        }, false);
            //音乐播放结束
                //        var html = '';
            //        for (var j in window) {
            //            html += j + '<br/>' + window[j] + '<br/>-----<br/>';
            //        }
            //        ;
            //document.body.innerHTML = html;
                    //document.body.innerHTML = getComputedStyle(document.body,null).height;

    </script>
</html>
    
